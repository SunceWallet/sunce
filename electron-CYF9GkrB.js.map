{"version":3,"file":"electron-CYF9GkrB.js","sources":["../src/Platform/ipc/electron.ts"],"sourcesContent":["import pick from \"lodash.pick\"\nimport { CustomError } from \"../../Generic/lib/errors\"\n\nlet nextCallID = 1\n\nexport function call<Message extends keyof IPC.MessageType>(\n  messageType: Message,\n  ...args: IPC.MessageArgs<Message>\n): Promise<IPC.MessageReturnType<Message>> {\n  const callID = nextCallID++\n\n  window.electron!.sendIPCMessage(messageType, {\n    args,\n    callID\n  })\n\n  return new Promise<IPC.MessageReturnType<Message>>((resolve, reject) => {\n    const unsubscribe = window.electron!.subscribeToIPCMessages(messageType, (event: Event, message: any) => {\n      // TODO look into this again\n      if (!message || typeof message !== \"object\" || message.callID !== callID) {\n        return\n      }\n\n      unsubscribe()\n\n      if (\"error\" in message && message.error) {\n        const error = message.error\n        const extra = error.__extraProps ? pick(error, error.__extraProps || []) : undefined\n        reject(CustomError(error.name, error.message, extra))\n      } else {\n        resolve((message as ElectronIPCCallResultMessage).result)\n      }\n    })\n  })\n}\n\ntype UnsubscribeFn = () => void\n\nexport function subscribeToMessages<Message extends keyof IPC.MessageType>(\n  messageType: Message,\n  callback: (message: any) => void\n): UnsubscribeFn {\n  return window.electron!.subscribeToIPCMessages(messageType, (event: Event, message: any) => callback(message))\n}\n"],"names":["nextCallID","call","messageType","args","callID","resolve","reject","unsubscribe","event","message","error","extra","pick","CustomError","subscribeToMessages","callback"],"mappings":"+CAGA,IAAIA,EAAa,EAED,SAAAC,EACdC,KACGC,EACsC,CACzC,MAAMC,EAASJ,IAER,cAAA,SAAU,eAAeE,EAAa,CAC3C,KAAAC,EACA,OAAAC,CAAA,CACD,EAEM,IAAI,QAAwC,CAACC,EAASC,IAAW,CACtE,MAAMC,EAAc,OAAO,SAAU,uBAAuBL,EAAa,CAACM,EAAcC,IAAiB,CAEvG,GAAI,GAACA,GAAW,OAAOA,GAAY,UAAYA,EAAQ,SAAWL,GAM9D,GAFQG,EAAA,EAER,UAAWE,GAAWA,EAAQ,MAAO,CACvC,MAAMC,EAAQD,EAAQ,MAChBE,EAAQD,EAAM,aAAeE,EAAKF,EAAOA,EAAM,cAAgB,CAAE,CAAA,EAAI,OAC3EJ,EAAOO,EAAYH,EAAM,KAAMA,EAAM,QAASC,CAAK,CAAC,CAAA,MAEpDN,EAASI,EAAyC,MAAM,CAC1D,CACD,CAAA,CACF,CACH,CAIgB,SAAAK,EACdZ,EACAa,EACe,CACR,OAAA,OAAO,SAAU,uBAAuBb,EAAa,CAACM,EAAcC,IAAiBM,EAASN,CAAO,CAAC,CAC/G"}