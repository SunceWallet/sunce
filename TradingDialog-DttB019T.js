import{R as e,$ as L,a8 as _,bK as ye,U as fe,V as be,W as pe,g as he,ap as o,be as $,bf as ae,bd as R,bZ as ve,ae as ne,bz as Ae,ad as re,ac as Ee,a9 as xe,aS as Se,bc as Pe,a6 as B,b5 as Me,c3 as Be,av as we,a5 as U,aM as Ce,al as Y,bm as z,bL as Te,aw as Ie,E as ie,ag as De,aQ as Fe,a0 as se,a1 as oe,a2 as le,Y as Re,b0 as ke,au as Q,ak as Le,b1 as qe,aa as Oe,bt as Ge,bY as Ve}from"./app-WI3p6lH-.js";import{n as We,p as k,F as P,M as K,c as ze,q as Z,E as _e,P as ce,T as $e,b as Ne,k as N,t as C,r as He,v as Xe,m as je,w as Ue,x as Ye,y as Qe}from"./app-stage2-0MVUtsPD.js";import{R as Ke,E as Ze,a as Je,b as et}from"./Remove-Cvc7f3oM.js";import{M as J}from"./MainSelectionButton-Cmfrg6Fj.js";const tt=e.forwardRef(function(a,s){const{t:r}=L();return e.createElement(_,{ref:s,justifyContent:"space-evenly",margin:"48px 0 24px",padding:"0 8px",wrap:"wrap"},e.createElement(J,{label:r("trading.action-selection.buy.label"),description:r("trading.action-selection.buy.description"),gutterBottom:!0,onClick:a.onSelectBuy,Icon:ye}),e.createElement(J,{label:r("trading.action-selection.sell.label"),description:r("trading.action-selection.sell.description"),gutterBottom:!0,onClick:a.onSelectSell,Icon:Ke}))}),at=e.memo(tt);var w={},ee;function nt(){if(ee)return w;ee=1;var t=fe();Object.defineProperty(w,"__esModule",{value:!0}),w.default=void 0;var a=t(be()),s=t(pe()),r=(0,s.default)(a.default.createElement(a.default.Fragment,null,a.default.createElement("defs",null,a.default.createElement("path",{id:"a",d:"M0 0h24v24H0V0z"})),a.default.createElement("path",{d:"M1 21h12v2H1zM5.245 8.07l2.83-2.827 14.14 14.142-2.828 2.828zM12.317 1l5.657 5.656-2.83 2.83-5.654-5.66zM3.825 9.485l5.657 5.657-2.828 2.828-5.657-5.657z"})),"Gavel");return w.default=r,w}var rt=nt();const it=he(rt);function st(t,a){if(t.length===0||a.length===0)return{absoluteSpread:0,relativeSpread:0};const s=Number.parseFloat(t[0].price)-Number.parseFloat(a[0].price),r=s/Math.min(Number.parseFloat(t[0].price),Number.parseFloat(a[0].price));return{absoluteSpread:s,relativeSpread:r}}const ot=t=>t.reduce((a,s)=>a.add(s),o(0));function lt(t,a,s=!1){const r=s?t.map(l=>({...l,amount:o(l.price).eq(0)?o(0).toFixed(7):o(l.amount).div(l.price).toFixed(7)})):t,c=e.useMemo(()=>{const l=[];let d=o(0);for(const i of r){if(d.gte(a))break;o(i.price).eq(0)||(l.push(i),d=d.add(i.amount))}return{offers:l,volume:d}},[r,a]),n=c.offers.map(l=>o(l.price)),m=n.length>0?n[n.length-1]:void 0,g=c.offers.slice(0,-1),u=c.offers[c.offers.length-1];return{estimatedReturn:ot([...g.slice(0,-1).map(l=>o(l.amount).mul(l.price)),u?o(u.price).mul(o(u.amount).sub(c.volume.sub(a))):o(0)]),worstPriceOfBestMatches:m}}const F=(t,a)=>We(t,{minimumSignificants:3,maximumSignificants:9,groupThousands:!1,...a});function te(t,a){const s=R(t,a).minus(o(a.asset_type==="native"?ve:o(0)));return s.cmp(o(0))<0?o(0):s}function ct(t){const{accountData:a,priceMode:s,primaryAction:r,tradePair:c}=t,{manualPrice:n,primaryAmountString:m,primaryAsset:g,secondaryAsset:u}=t.values,h=n&&k(n)?s==="secondary"?P(n):P(n).eq(0)?o(0):o(1).div(P(n)):o(0),l=m&&k(m)?P(m):o(0),d=g?$(a.balances,g):void 0,i=u?$(a.balances,u):void 0,{worstPriceOfBestMatches:y}=lt(r==="buy"?c.asks:c.bids,l.gt(0)?l:o(.01),r==="sell"),{relativeSpread:f}=st(c.asks,c.bids),v=y&&y.gt(0)?y:void 0,b=h.gt(0)?h:v||o(0),T=l.mul(b),q=b.eq(0)?o(0):o(1).div(b),I=F(s==="secondary"?b:q),E=ae(a),A=d?r==="sell"?te(E,d):R(E,d):o(0),x=i?r==="buy"?te(E,i):R(E,i):o(0),M=r==="buy"?x.gt(0)&&b.gt(0)?o(x).div(b):o(0):A.gt(0)?o(A):o(0);return{defaultPrice:I,effectivePrice:b,maxPrimaryAmount:M,minAccountBalance:E,primaryAmount:l,primaryBalance:d,relativeSpread:f,secondaryAmount:T,secondaryBalance:i,spendablePrimaryBalance:A,spendableSecondaryBalance:x}}const ut=e.forwardRef(function(a,s){var u,h;const r=!a.primaryAsset||!a.secondaryAsset,{t:c}=L(),n=a.priceDenotedIn==="primary"?(u=a.secondaryAsset)==null?void 0:u.getCode():(h=a.primaryAsset)==null?void 0:h.getCode(),m=n?c("trading.trading-price.label",{unit:n}):c("trading.trading-price.default-label"),g=e.createElement(ne,{position:"end"},e.createElement(Ae,{disabled:r,disableUnderline:!0,onChange:l=>a.onSetPriceDenotedIn(l.target.value),style:{fontWeight:400},value:a.priceDenotedIn},e.createElement(K,{selected:a.priceDenotedIn==="secondary",value:"secondary"},a.secondaryAsset?a.secondaryAsset.getCode():""),e.createElement(K,{selected:a.priceDenotedIn==="primary",value:"primary"},a.primaryAsset?a.primaryAsset.getCode():"")));return e.createElement(re,{inputProps:{pattern:"^[0-9]*(.[0-9]+)?$",inputMode:"decimal",min:"0.0000001"},InputProps:{endAdornment:g},inputRef:s,error:!!a.inputError,label:a.inputError||m,onBlur:a.onBlur,onChange:a.onChange,onFocus:a.selectOnFocus?l=>l.target.select():void 0,style:a.style,value:a.defaultPrice?a.defaultPrice:a.manualPrice})}),mt=e.memo(ut),dt=Ee({expansionPanel:{background:"transparent",margin:"8px 0 !important","&:before":{background:"transparent"}},expansionPanelSummary:{justifyContent:"flex-start",minHeight:"48px !important",padding:0},expansionPanelSummaryContent:{flexGrow:0,marginTop:"0 !important",marginBottom:"0 !important"},expansionPanelDetails:{justifyContent:"flex-start",paddingLeft:0,paddingRight:0,paddingTop:12}});function gt(t){var j;const a=dt(),s=xe(),r=Se("(max-height: 500px)"),c=s||r,{t:n}=L(),[m,g]=e.useState(!1),[u,h]=e.useState("secondary"),[l,d]=e.useState(!1),i=Pe({defaultValues:{primaryAsset:t.initialPrimaryAsset,primaryAmountString:"",secondaryAsset:B.Asset.native(),manualPrice:"0"}}),y=t.sendTransaction,{primaryAsset:f,secondaryAsset:v,manualPrice:b}=i.watch();e.useEffect(()=>{!f&&t.initialPrimaryAsset&&i.setValue("primaryAsset",t.initialPrimaryAsset)},[i,f,t.initialPrimaryAsset]);const T=Me(t.account.testnet),q=Be(f||B.Asset.native(),v,t.account.testnet),I=e.useMemo(()=>t.trustlines.map(we),[t.trustlines]),E=ct({accountData:t.accountData,priceMode:u,primaryAction:t.primaryAction,tradePair:q,values:i.getValues()}),{maxPrimaryAmount:A,primaryBalance:x,defaultPrice:M,effectivePrice:O,primaryAmount:S,relativeSpread:G,secondaryAmount:H,secondaryBalance:V,spendablePrimaryBalance:ue,spendableSecondaryBalance:me}=E;i.formState.touched.primaryAmountString&&setTimeout(()=>i.triggerValidation("primaryAmountString"),0);const de=()=>{i.setValue("primaryAmountString",A.toFixed(7))},X=e.useCallback(()=>{const p=P(b).gt(0)?b:M;if(!(k(p)&&P(p).gt(0)))return m||g(!0),n("trading.validation.invalid-price")},[M,m,b,n]),ge=e.useCallback(async()=>{try{d(!0);const p=X();if(p){i.setError("manualPrice","invalid-amount",p);return}if(!f)throw U("InvariantViolationError","Invariant violation: Should not be able to submit form without having selected the primary asset.",{message:"Should not be able to submit form without having selected the primary asset."});if(R(ae(t.accountData),$(t.accountData.balances,B.Asset.native())).minus(.5).cmp(0)<=0)throw U("LowReserveOrderError","Cannot place order because spendable XLM balance is too low.");const W=await ze([t.primaryAction==="buy"?B.Operation.manageBuyOffer({buyAmount:S.toFixed(7),buying:f,offerId:0,price:O.toFixed(7),selling:v,withMuxing:!0}):B.Operation.manageSellOffer({amount:S.toFixed(7),buying:v,offerId:0,price:O.toFixed(7),selling:f,withMuxing:!0})],{accountData:t.accountData,horizon:T,walletAccount:t.account});await y(W)}catch(p){Ce(p)}finally{d(!1)}},[i,O,T,f,t.account,t.accountData,t.primaryAction,S,v,y,X]);return e.createElement(Y,{alignItems:"stretch",alignSelf:c?void 0:"center",grow:1,minHeight:300,maxHeight:"100%",margin:s?void 0:"32px 0 0",padding:"16px 0",shrink:1,width:"100%"},e.createElement(Y,{alignItems:"stretch",alignSelf:s?"stretch":"center",minWidth:s?"75%":450,maxWidth:s?"100%":500,padding:"0 2px",shrink:0,width:"100%"},e.createElement(_,{margin:"8px 0"},e.createElement(z,{as:e.createElement(Z,{assets:I,inputError:i.errors.primaryAsset&&i.errors.primaryAsset.message,label:t.primaryAction==="buy"?n("trading.inputs.primary-asset-selector.label.buy"):n("trading.inputs.primary-asset-selector.label.sell"),minWidth:75,showXLM:!0,style:{flexGrow:1,marginRight:24,maxWidth:150,width:"25%"},testnet:t.account.testnet,value:f}),control:i.control,name:"primaryAsset",rules:{required:n("trading.validation.primary-asset-missing")}}),e.createElement(re,{name:"primaryAmountString",inputRef:i.register({required:n("trading.validation.primary-amount-missing"),validate:p=>{const D=S.lt(0)||p.length>0&&S.eq(0),W=t.primaryAction==="sell"&&x&&S.gt(ue)||t.primaryAction==="buy"&&V&&H.gt(me);return D?n("trading.validation.invalid-amount"):W?n("trading.validation.not-enough-balance"):!0}}),error:!!i.errors.primaryAmountString,inputProps:{pattern:"^[0-9]*(.[0-9]+)?$",inputMode:"decimal",min:"0.0000001",max:A.toFixed(7),style:{height:27}},InputProps:{endAdornment:t.primaryAction==="buy"?void 0:e.createElement(ne,{position:"end"},e.createElement(Te,{disabled:!f||!x,onClick:de,style:{boxShadow:"none",fontWeight:400}},n("trading.inputs.primary-amount.max-button.label")))},label:i.errors.primaryAmountString&&i.errors.primaryAmountString.message?i.errors.primaryAmountString.message:t.primaryAction==="buy"?n("trading.inputs.primary-amount.label.buy"):n("trading.inputs.primary-amount.label.sell"),placeholder:n("trading.inputs.primary-amount.placeholder",`Max. ${F(A)}`,{amount:F(A)}),required:!0,style:{flexGrow:1,flexShrink:1,width:"55%"}})),e.createElement(_,{margin:"8px 0 32px"},e.createElement(z,{as:e.createElement(Z,{assets:I,label:t.primaryAction==="buy"?n("trading.inputs.secondary-asset-selector.label.buy"):n("trading.inputs.secondary-asset-selector.label.sell"),minWidth:75,showXLM:!0,style:{flexGrow:1,marginRight:24,maxWidth:150,width:"25%"},testnet:t.account.testnet,value:v}),control:i.control,name:"secondaryAsset",rules:{required:n("trading.validation.secondary-asset-missing")}}),e.createElement(Ie,{disableUnderline:!0,inputProps:{style:{height:27}},label:t.primaryAction==="buy"?n("trading.inputs.estimated-costs.label.buy"):n("trading.inputs.estimated-costs.label.sell"),placeholder:`Max. ${V?V.balance:"0"}`,style:{flexGrow:1,flexShrink:1,width:"55%"},inputMode:"decimal",type:"number",value:F(H,{groupThousands:!1})})),e.createElement(Ze,{className:a.expansionPanel,elevation:0,expanded:m,onChange:()=>g(!m)},e.createElement(Je,{classes:{root:a.expansionPanelSummary,content:a.expansionPanelSummaryContent},expandIcon:e.createElement(_e,null)},e.createElement(ie,{align:"center",style:{flexGrow:1}},n("trading.advanced.header"))),e.createElement(et,{className:a.expansionPanelDetails},e.createElement(z,{as:e.createElement(mt,{defaultPrice:i.formState.touched.manualPrice?void 0:M,inputError:i.errors.manualPrice&&i.errors.manualPrice.message,onSetPriceDenotedIn:h,priceDenotedIn:u,primaryAsset:f,secondaryAsset:v,selectOnFocus:!0,style:{flexGrow:1,maxWidth:250,width:"55%"}}),control:i.control,name:"manualPrice",rules:{validate:p=>k(p)||n("trading.validation.invalid-price")},valueName:"manualPrice"}))),G>=.015?e.createElement(De,{margin:"32px 0 0",padding:"8px 12px",style:{background:Fe}},e.createElement("b",null,n("trading.warning.title")),e.createElement("br",null),n("trading.warning.message",`The spread between buying and selling price is about ${(G*100).toFixed(1)}%.`,{spread:(G*100).toFixed(1)})):null,e.createElement(ce,{target:(j=t.dialogActionsRef)==null?void 0:j.element},e.createElement(se,{desktopStyle:{marginTop:32}},e.createElement(oe,{loading:l,icon:e.createElement(it,null),onClick:i.handleSubmit(ge),type:"primary"},n("trading.action.submit"))))))}const yt=e.memo(gt);function ft(t){if(N(t,C("*",void 0,"*"))){const a=Qe(t);if(a!=="buy"&&a!=="sell")return Ve(a)}}function bt(t){const a=Re(t.account.accountID,t.account.testnet),s=ke(),r=le(),[c,n]=e.useState(),{t:m}=L();e.useEffect(()=>{const y=ft(r.location.pathname);n(y)},[r.location.pathname]);const g=e.useMemo(()=>a.balances.filter(y=>y.asset_type!=="native"),[a.balances]),u=N(r.location.pathname,C("*","buy"))?"buy":N(r.location.pathname,C("*","sell"))?"sell":void 0,h=e.useCallback(()=>{r.history.push(C(t.account.id,void 0,c?Q(c):void 0))},[c,t.account,r.history]),l=e.useCallback(y=>{r.history.push(C(t.account.id,y,c?Q(c):void 0))},[c,t.account,r.history]),d=e.useMemo(()=>e.createElement(He,{current:u?1:0},e.createElement(at,{onSelectBuy:()=>l("buy"),onSelectSell:()=>l("sell")}),e.createElement(e.Suspense,{fallback:e.createElement(Le,null)},e.createElement(yt,{account:t.account,accountData:a,dialogActionsRef:u?s:null,initialPrimaryAsset:c,primaryAction:u||"buy",sendTransaction:t.sendTransaction,trustlines:g}))),[a,s,c,u,t.account,t.sendTransaction,l,g]),i=e.useMemo(()=>e.createElement(Xe,{margin:"32px 0 0",textAlign:"center"},e.createElement(ie,null,m("trading.no-assets-info")),e.createElement(ce,{target:s.element},e.createElement(se,null,e.createElement(oe,{autoFocus:!0,onClick:()=>r.history.push(je(t.account.id)),type:"primary"},m("trading.action.add-asset"))))),[s,t.account,r,m]);return e.createElement(qe,{top:e.createElement(e.Fragment,null,e.createElement(Oe,{title:e.createElement("span",null,m("trading.title"),t.account.testnet?e.createElement(Ue,{style:{marginLeft:8}}):null),onBack:u?h:t.onClose}),e.createElement(Ye,{account:t.account,compact:!0})),actions:s},e.createElement(Ge,null,g.length>0?d:i))}function Et(t){const a=le(),s=()=>a.history.push(Ne(t.account.id));return e.createElement($e,{account:t.account,onSubmissionCompleted:s},r=>e.createElement(bt,{...t,...r}))}export{Et as default};
//# sourceMappingURL=TradingDialog-DttB019T.js.map
