import{R as e,$ as L,a8 as $,bK as pe,U as he,V as ve,W as Ae,g as xe,ap as o,be as N,bf as ie,bd as k,bZ as Ee,ae as se,bz as Se,ad as oe,ac as Pe,a9 as Me,aS as Be,bc as we,a6 as B,b5 as Ce,c3 as Ie,av as Te,a5 as Y,aM as De,al as Q,bm as z,bL as Fe,aw as ke,E as ce,ag as K,aQ as Z,a0 as le,a1 as ue,a2 as me,Y as Re,b0 as Le,au as J,ak as Oe,b1 as qe,aa as Ge,bt as Ve,bY as We}from"./app-Csw4Kn1B.js";import{n as _e,p as R,F as P,M as ee,c as ze,q as te,E as $e,P as de,T as Ne,b as He,k as H,t as C,r as Xe,v as je,m as Ue,w as Ye,x as Qe,y as Ke}from"./app-stage2-b6iQ5NMd.js";import{R as Ze,E as Je,a as et,b as tt}from"./Remove-llg1lICY.js";import{M as ae}from"./MainSelectionButton-Cx5QJ0Xr.js";const at=e.forwardRef(function(a,s){const{t:r}=L();return e.createElement($,{ref:s,justifyContent:"space-evenly",margin:"48px 0 24px",padding:"0 8px",wrap:"wrap"},e.createElement(ae,{label:r("trading.action-selection.buy.label"),description:r("trading.action-selection.buy.description"),gutterBottom:!0,onClick:a.onSelectBuy,Icon:pe}),e.createElement(ae,{label:r("trading.action-selection.sell.label"),description:r("trading.action-selection.sell.description"),gutterBottom:!0,onClick:a.onSelectSell,Icon:Ze}))}),nt=e.memo(at);var w={},ne;function rt(){if(ne)return w;ne=1;var t=he();Object.defineProperty(w,"__esModule",{value:!0}),w.default=void 0;var a=t(ve()),s=t(Ae()),r=(0,s.default)(a.default.createElement(a.default.Fragment,null,a.default.createElement("defs",null,a.default.createElement("path",{id:"a",d:"M0 0h24v24H0V0z"})),a.default.createElement("path",{d:"M1 21h12v2H1zM5.245 8.07l2.83-2.827 14.14 14.142-2.828 2.828zM12.317 1l5.657 5.656-2.83 2.83-5.654-5.66zM3.825 9.485l5.657 5.657-2.828 2.828-5.657-5.657z"})),"Gavel");return w.default=r,w}var it=rt();const st=xe(it);function ot(t,a){if(t.length===0||a.length===0)return{absoluteSpread:0,relativeSpread:0};const s=Number.parseFloat(t[0].price)-Number.parseFloat(a[0].price),r=s/Math.min(Number.parseFloat(t[0].price),Number.parseFloat(a[0].price));return{absoluteSpread:s,relativeSpread:r}}const ct=t=>t.reduce((a,s)=>a.add(s),o(0));function lt(t,a,s=!1){const r=s?t.map(c=>({...c,amount:o(c.price).eq(0)?o(0).toFixed(7):o(c.amount).div(c.price).toFixed(7)})):t,l=e.useMemo(()=>{const c=[];let g=o(0);for(const i of r){if(g.gte(a))break;o(i.price).eq(0)||(c.push(i),g=g.add(i.amount))}return{offers:c,volume:g}},[r,a]),n=l.offers.map(c=>o(c.price)),d=n.length>0?n[n.length-1]:void 0,y=l.offers.slice(0,-1),m=l.offers[l.offers.length-1];return{estimatedReturn:ct([...y.slice(0,-1).map(c=>o(c.amount).mul(c.price)),m?o(m.price).mul(o(m.amount).sub(l.volume.sub(a))):o(0)]),worstPriceOfBestMatches:d}}const F=(t,a)=>_e(t,{minimumSignificants:3,maximumSignificants:9,groupThousands:!1,...a});function re(t,a){const s=k(t,a).minus(o(a.asset_type==="native"?Ee:o(0)));return s.cmp(o(0))<0?o(0):s}function ut(t){const{accountData:a,priceMode:s,primaryAction:r,tradePair:l}=t,{manualPrice:n,primaryAmountString:d,primaryAsset:y,secondaryAsset:m}=t.values,h=n&&R(n)?s==="secondary"?P(n):P(n).eq(0)?o(0):o(1).div(P(n)):o(0),c=d&&R(d)?P(d):o(0),g=y?N(a.balances,y):void 0,i=m?N(a.balances,m):void 0,{worstPriceOfBestMatches:f}=lt(r==="buy"?l.asks:l.bids,c.gt(0)?c:o(.01),r==="sell"),{relativeSpread:u}=ot(l.asks,l.bids),v=f&&f.gt(0)?f:void 0,b=h.gt(0)?h:v||o(0),E=c.mul(b),I=b.eq(0)?o(0):o(1).div(b),O=F(s==="secondary"?b:I),A=ie(a),M=g?r==="sell"?re(A,g):k(A,g):o(0),x=i?r==="buy"?re(A,i):k(A,i):o(0),T=r==="buy"?x.gt(0)&&b.gt(0)?o(x).div(b):o(0):M.gt(0)?o(M):o(0);return{defaultPrice:O,effectivePrice:b,maxPrimaryAmount:T,minAccountBalance:A,primaryAmount:c,primaryBalance:g,relativeSpread:u,secondaryAmount:E,secondaryBalance:i,spendablePrimaryBalance:M,spendableSecondaryBalance:x}}const mt=e.forwardRef(function(a,s){var m,h;const r=!a.primaryAsset||!a.secondaryAsset,{t:l}=L(),n=a.priceDenotedIn==="primary"?(m=a.secondaryAsset)==null?void 0:m.getCode():(h=a.primaryAsset)==null?void 0:h.getCode(),d=n?l("trading.trading-price.label",{unit:n}):l("trading.trading-price.default-label"),y=e.createElement(se,{position:"end"},e.createElement(Se,{disabled:r,disableUnderline:!0,onChange:c=>a.onSetPriceDenotedIn(c.target.value),style:{fontWeight:400},value:a.priceDenotedIn},e.createElement(ee,{selected:a.priceDenotedIn==="secondary",value:"secondary"},a.secondaryAsset?a.secondaryAsset.getCode():""),e.createElement(ee,{selected:a.priceDenotedIn==="primary",value:"primary"},a.primaryAsset?a.primaryAsset.getCode():"")));return e.createElement(oe,{inputProps:{pattern:"^[0-9]*(.[0-9]+)?$",inputMode:"decimal",min:"0.0000001"},InputProps:{endAdornment:y},inputRef:s,error:!!a.inputError,label:a.inputError||d,onBlur:a.onBlur,onChange:a.onChange,onFocus:a.selectOnFocus?c=>c.target.select():void 0,style:a.style,value:a.defaultPrice?a.defaultPrice:a.manualPrice})}),dt=e.memo(mt),gt=Pe({expansionPanel:{background:"transparent",margin:"8px 0 !important","&:before":{background:"transparent"}},expansionPanelSummary:{justifyContent:"flex-start",minHeight:"48px !important",padding:0},expansionPanelSummaryContent:{flexGrow:0,marginTop:"0 !important",marginBottom:"0 !important"},expansionPanelDetails:{justifyContent:"flex-start",paddingLeft:0,paddingRight:0,paddingTop:12}});function yt(t){var U;const a=gt(),s=Me(),r=Be("(max-height: 500px)"),l=s||r,{t:n}=L(),[d,y]=e.useState(!1),[m,h]=e.useState("secondary"),[c,g]=e.useState(!1),i=we({defaultValues:{primaryAsset:t.initialPrimaryAsset,primaryAmountString:"",secondaryAsset:B.Asset.native(),manualPrice:"0"}}),f=t.sendTransaction,{primaryAsset:u,secondaryAsset:v,manualPrice:b}=i.watch(),E=e.useMemo(()=>(u==null?void 0:u.getIssuer())===t.accountData.account_id,[t.accountData,u]);e.useEffect(()=>{!u&&t.initialPrimaryAsset&&i.setValue("primaryAsset",t.initialPrimaryAsset)},[i,u,t.initialPrimaryAsset]);const I=Ce(t.account.testnet),O=Ie(u||B.Asset.native(),v,t.account.testnet),A=e.useMemo(()=>t.trustlines.map(Te),[t.trustlines]),M=ut({accountData:t.accountData,priceMode:m,primaryAction:t.primaryAction,tradePair:O,values:i.getValues()}),{maxPrimaryAmount:x,primaryBalance:T,defaultPrice:q,effectivePrice:G,primaryAmount:S,relativeSpread:V,secondaryAmount:X,secondaryBalance:W,spendablePrimaryBalance:ge,spendableSecondaryBalance:ye}=M;i.formState.touched.primaryAmountString&&setTimeout(()=>i.triggerValidation("primaryAmountString"),0);const fe=()=>{i.setValue("primaryAmountString",x.toFixed(7))},j=e.useCallback(()=>{const p=P(b).gt(0)?b:q;if(!(R(p)&&P(p).gt(0)))return d||y(!0),n("trading.validation.invalid-price")},[q,d,b,n]),be=e.useCallback(async()=>{try{g(!0);const p=j();if(p){i.setError("manualPrice","invalid-amount",p);return}if(!u)throw Y("InvariantViolationError","Invariant violation: Should not be able to submit form without having selected the primary asset.",{message:"Should not be able to submit form without having selected the primary asset."});if(k(ie(t.accountData),N(t.accountData.balances,B.Asset.native())).minus(.5).cmp(0)<=0)throw Y("LowReserveOrderError","Cannot place order because spendable XLM balance is too low.");const _=await ze([t.primaryAction==="buy"?B.Operation.manageBuyOffer({buyAmount:S.toFixed(7),buying:u,offerId:0,price:G.toFixed(7),selling:v,withMuxing:!0}):B.Operation.manageSellOffer({amount:S.toFixed(7),buying:v,offerId:0,price:G.toFixed(7),selling:u,withMuxing:!0})],{accountData:t.accountData,horizon:I,walletAccount:t.account});await f(_)}catch(p){De(p)}finally{g(!1)}},[i,G,I,u,t.account,t.accountData,t.primaryAction,S,v,f,j]);return e.createElement(Q,{alignItems:"stretch",alignSelf:l?void 0:"center",grow:1,minHeight:300,maxHeight:"100%",margin:s?void 0:"32px 0 0",padding:"16px 0",shrink:1,width:"100%"},e.createElement(Q,{alignItems:"stretch",alignSelf:s?"stretch":"center",minWidth:s?"75%":450,maxWidth:s?"100%":500,padding:"0 2px",shrink:0,width:"100%"},e.createElement($,{margin:"8px 0"},e.createElement(z,{as:e.createElement(te,{assets:A,inputError:i.errors.primaryAsset&&i.errors.primaryAsset.message,label:t.primaryAction==="buy"?n("trading.inputs.primary-asset-selector.label.buy"):n("trading.inputs.primary-asset-selector.label.sell"),minWidth:75,showXLM:!0,style:{flexGrow:1,marginRight:24,maxWidth:150,width:"25%"},testnet:t.account.testnet,value:u}),control:i.control,name:"primaryAsset",rules:{required:n("trading.validation.primary-asset-missing")}}),e.createElement(oe,{name:"primaryAmountString",inputRef:i.register({required:n("trading.validation.primary-amount-missing"),validate:p=>{const D=S.lt(0)||p.length>0&&S.eq(0);if(E)return!0;const _=t.primaryAction==="sell"&&T&&S.gt(ge)||t.primaryAction==="buy"&&W&&X.gt(ye);return D?n("trading.validation.invalid-amount"):_?n("trading.validation.not-enough-balance"):!0}}),error:!!i.errors.primaryAmountString,inputProps:{pattern:"^[0-9]*(.[0-9]+)?$",inputMode:"decimal",min:"0.0000001",max:x.toFixed(7),style:{height:27}},InputProps:{endAdornment:t.primaryAction==="buy"||E?void 0:e.createElement(se,{position:"end"},e.createElement(Fe,{disabled:!u||!T,onClick:fe,style:{boxShadow:"none",fontWeight:400}},n("trading.inputs.primary-amount.max-button.label")))},label:i.errors.primaryAmountString&&i.errors.primaryAmountString.message?i.errors.primaryAmountString.message:t.primaryAction==="buy"?n("trading.inputs.primary-amount.label.buy"):n("trading.inputs.primary-amount.label.sell"),placeholder:E?"":n("trading.inputs.primary-amount.placeholder",`Max. ${F(x)}`,{amount:F(x)}),required:!0,style:{flexGrow:1,flexShrink:1,width:"55%"}})),e.createElement($,{margin:"8px 0 32px"},e.createElement(z,{as:e.createElement(te,{assets:A,label:t.primaryAction==="buy"?n("trading.inputs.secondary-asset-selector.label.buy"):n("trading.inputs.secondary-asset-selector.label.sell"),minWidth:75,showXLM:!0,style:{flexGrow:1,marginRight:24,maxWidth:150,width:"25%"},testnet:t.account.testnet,value:v}),control:i.control,name:"secondaryAsset",rules:{required:n("trading.validation.secondary-asset-missing")}}),e.createElement(ke,{disableUnderline:!0,inputProps:{style:{height:27}},label:t.primaryAction==="buy"?n("trading.inputs.estimated-costs.label.buy"):n("trading.inputs.estimated-costs.label.sell"),placeholder:`Max. ${W?W.balance:"0"}`,style:{flexGrow:1,flexShrink:1,width:"55%"},inputMode:"decimal",type:"number",value:F(X,{groupThousands:!1})})),e.createElement(Je,{className:a.expansionPanel,elevation:0,expanded:d,onChange:()=>y(!d)},e.createElement(et,{classes:{root:a.expansionPanelSummary,content:a.expansionPanelSummaryContent},expandIcon:e.createElement($e,null)},e.createElement(ce,{align:"center",style:{flexGrow:1}},n("trading.advanced.header"))),e.createElement(tt,{className:a.expansionPanelDetails},e.createElement(z,{as:e.createElement(dt,{defaultPrice:i.formState.touched.manualPrice?void 0:q,inputError:i.errors.manualPrice&&i.errors.manualPrice.message,onSetPriceDenotedIn:h,priceDenotedIn:m,primaryAsset:u,secondaryAsset:v,selectOnFocus:!0,style:{flexGrow:1,maxWidth:250,width:"55%"}}),control:i.control,name:"manualPrice",rules:{validate:p=>R(p)||n("trading.validation.invalid-price")},valueName:"manualPrice"}))),V>=.015?e.createElement(K,{margin:"32px 0 0",padding:"8px 12px",style:{background:Z}},e.createElement("b",null,n("trading.warning.title")),e.createElement("br",null),n("trading.warning.message",`The spread between buying and selling price is about ${(V*100).toFixed(1)}%.`,{spread:(V*100).toFixed(1)})):null,E?e.createElement(K,{margin:"32px 0 0",padding:"8px 12px",style:{background:Z}},n("trading.issuance",{asset:u==null?void 0:u.getCode()})):null,e.createElement(de,{target:(U=t.dialogActionsRef)==null?void 0:U.element},e.createElement(le,{desktopStyle:{marginTop:32}},e.createElement(ue,{loading:c,icon:e.createElement(st,null),onClick:i.handleSubmit(be),type:"primary"},n("trading.action.submit"))))))}const ft=e.memo(yt);function bt(t){if(H(t,C("*",void 0,"*"))){const a=Ke(t);if(a!=="buy"&&a!=="sell")return We(a)}}function pt(t){const a=Re(t.account.accountID,t.account.testnet),s=Le(),r=me(),[l,n]=e.useState(),{t:d}=L();e.useEffect(()=>{const f=bt(r.location.pathname);n(f)},[r.location.pathname]);const y=e.useMemo(()=>a.balances.filter(f=>f.asset_type!=="native"),[a.balances]),m=H(r.location.pathname,C("*","buy"))?"buy":H(r.location.pathname,C("*","sell"))?"sell":void 0,h=e.useCallback(()=>{r.history.push(C(t.account.id,void 0,l?J(l):void 0))},[l,t.account,r.history]),c=e.useCallback(f=>{r.history.push(C(t.account.id,f,l?J(l):void 0))},[l,t.account,r.history]),g=e.useMemo(()=>e.createElement(Xe,{current:m?1:0},e.createElement(nt,{onSelectBuy:()=>c("buy"),onSelectSell:()=>c("sell")}),e.createElement(e.Suspense,{fallback:e.createElement(Oe,null)},e.createElement(ft,{account:t.account,accountData:a,dialogActionsRef:m?s:null,initialPrimaryAsset:l,primaryAction:m||"buy",sendTransaction:t.sendTransaction,trustlines:y}))),[a,s,l,m,t.account,t.sendTransaction,c,y]),i=e.useMemo(()=>e.createElement(je,{margin:"32px 0 0",textAlign:"center"},e.createElement(ce,null,d("trading.no-assets-info")),e.createElement(de,{target:s.element},e.createElement(le,null,e.createElement(ue,{autoFocus:!0,onClick:()=>r.history.push(Ue(t.account.id)),type:"primary"},d("trading.action.add-asset"))))),[s,t.account,r,d]);return e.createElement(qe,{top:e.createElement(e.Fragment,null,e.createElement(Ge,{title:e.createElement("span",null,d("trading.title"),t.account.testnet?e.createElement(Ye,{style:{marginLeft:8}}):null),onBack:m?h:t.onClose}),e.createElement(Qe,{account:t.account,compact:!0})),actions:s},e.createElement(Ve,null,y.length>0?g:i))}function Et(t){const a=me(),s=()=>a.history.push(He(t.account.id));return e.createElement(Ne,{account:t.account,onSubmissionCompleted:s},r=>e.createElement(pt,{...t,...r}))}export{Et as default};
//# sourceMappingURL=TradingDialog-DwRdxFsb.js.map
